<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>日常笔记：python（2）</title>
<link rel="stylesheet" href="https://chenxinpeng.github.io/assets/css/jemdoc.css", type="text/css" />
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div class="container"><h2 id="preface">Preface</h2>

<p>日常纪录自己所查所用，为日后回忆留个方便，也给碰到类似问题的童鞋留个小参考。</p>

<p>不知不觉，进行到第二弹了，之前的 <a href="http://blog.csdn.net/u010167269/article/details/51912445">日常笔记：Python（1）</a> 已经比较冗余了。开一个新的吧，作为 （2）。</p>

<p><br></p>



<h2 id="查看-python-程序所占内存">查看 python 程序所占内存</h2>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> resource

print(<span class="hljs-string">"{}"</span>.format(resource.getrusage(resource.RUSAGE_SELF).ru_maxrss))</code></pre>

<p><br></p>



<h2 id="python-的-filter-函数">python 的 filter 函数</h2>

<p>The function <code>filter(function, list)</code> offers an elegant way to filter out all the elements of a <font color="blue">list</font>, for which the function function returns <code>True</code>. </p>

<p>The function <code>filter(f,l)</code> needs a function <code>f</code> as its first argument. <code>f</code> returns a Boolean value, i.e. either <code>True</code> or <code>False</code>. This function will be applied to every element of the list <code>l</code>. </p>

<p>Only if <code>f</code> returns <code>True</code> will the element of the list be included in the result list.</p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-prompt">&gt;&gt;&gt; </span>fib = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">8</span>,<span class="hljs-number">13</span>,<span class="hljs-number">21</span>,<span class="hljs-number">34</span>,<span class="hljs-number">55</span>]
<span class="hljs-prompt">&gt;&gt;&gt; </span>result = filter(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span>, fib)
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-keyword">print</span> result
[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">13</span>, <span class="hljs-number">21</span>, <span class="hljs-number">55</span>]
<span class="hljs-prompt">&gt;&gt;&gt; </span>result = filter(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, fib)
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-keyword">print</span> result
[<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">34</span>]
<span class="hljs-prompt">&gt;&gt;&gt; </span></code></pre>

<p><br></p>



<h2 id="何时该使用-gpu">何时该使用 GPU</h2>

<p>Not all operations can be done on GPUs. </p>

<p>If you get the following error, you are trying to do an operation that can not be done on a GPU:</p>

<blockquote>
  <p>Cannot assign a device to node <code>PyFunc</code>: Could not satisfy explicit device specification <code>/device:GPU:1</code> because no devices matching that specification are registered in this process.</p>
</blockquote>

<p><br></p>



<h2 id="python-的-zip-函数">python 的 zip 函数</h2>

<p><a href="https://docs.python.org/2/library/functions.html#zip">https://docs.python.org/2/library/functions.html#zip</a></p>

<p><br></p>



<h2 id="python-的-linspace-函数">python 的 linspace 函数</h2>

<p><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html">https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html</a></p>

<p><br></p>



<h2 id="画训练误差曲线">画训练误差曲线</h2>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

errors = []

plt.plot([np.mean(errors[i-<span class="hljs-number">50</span>:i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(errors))])
plt.show()
plt.savefig(<span class="hljs-string">"errors.png"</span>)</code></pre>

<p><br></p>



<h2 id="tensorflow-中-rnncell-问题">Tensorflow 中 rnn_cell 问题</h2>

<p>在训练中，碰到了如下的问题：</p>



<pre class="prettyprint"><code class="language-shell hljs livecodeserver">output, state = lstm(lstm_input, state)

ValueError: setting <span class="hljs-operator">an</span> array <span class="hljs-keyword">element</span> <span class="hljs-operator">with</span> <span class="hljs-operator">a</span> sequence.</code></pre>

<p>具体的，十分的类似于这个链接里所描述的：<a href="https://github.com/Russell91/TensorBox/issues/59">https://github.com/Russell91/TensorBox/issues/59</a></p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-comment">#-*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> ipdb

<span class="hljs-keyword">import</span> cv2

<span class="hljs-comment">#from tensorflow.models.rnn import rnn_cell</span>

<span class="hljs-keyword">from</span> keras.preprocessing <span class="hljs-keyword">import</span> sequence

self.lstm1 = tf.nn.rnn_cell.BasicLSTMCell(dim_hidden, state_is_tuple=<span class="hljs-keyword">False</span>)
self.lstm2 = tf.nn.rnn_cell.BasicLSTMCell(dim_hidden, state_is_tuple=<span class="hljs-keyword">False</span>)</code></pre>

<p>这是由于新版本的 Tensorflow 与旧版本的冲突导致的，加一个：</p>



<pre class="prettyprint"><code class="language-python hljs ">state_is_tuple = <span class="hljs-keyword">False</span></code></pre>

<p><br></p>



<h2 id="matplotlib-画图">matplotlib 画图</h2>

<p>用来画 loss 的曲线图： <br>
<a href="http://www.cnblogs.com/wei-li/archive/2012/05/23/2506940.html">http://www.cnblogs.com/wei-li/archive/2012/05/23/2506940.html</a> <br>
<a href="http://www.jianshu.com/p/ee8bb1bd0019">http://www.jianshu.com/p/ee8bb1bd0019</a> <br>
<a href="http://blog.csdn.net/freewebsys/article/details/52577631">http://blog.csdn.net/freewebsys/article/details/52577631</a></p>

<p><br></p>



<h2 id="ipdb-单步调试">ipdb 单步调试</h2>

<p>这几天才发现的一个大杀器，很好用： <br>
<a href="http://tt4it.com/exchange/blog/discuss/22/">http://tt4it.com/exchange/blog/discuss/22/</a></p>

<p><br></p>



<h2 id="caffe-指定运行的-gpu-编号">caffe 指定运行的 GPU 编号</h2>

<p><a href="http://kawahara.ca/caffe-how-to-specify-which-gpu-to-use-in-pycaffe/">http://kawahara.ca/caffe-how-to-specify-which-gpu-to-use-in-pycaffe/</a></p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> caffe
GPU_ID = <span class="hljs-number">1</span> <span class="hljs-comment"># Switch between 0 and 1 depending on the GPU you want to use.</span>
caffe.set_mode_gpu()
caffe.set_device(GPU_ID)</code></pre>

<p>事实上，可以先在 <code>~/.bashrc</code> 文件中：</p>



<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-keyword">export</span> CUDA_VISIBLE_DEVICES = <span class="hljs-number">0</span></code></pre>

<p>如果这里的  <code>~/.bashrc</code> 文件中指定了 <code>0</code> 号 GPU，那么，后面指定几号都没用了。所以，如果要想后面指定 GPU，这里一定好使得所有的 GPU 都可见：</p>



<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-keyword">export</span> CUDA_VISIBLE_DEVICES = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span></code></pre>

<p><br></p>



<h2 id="删除-list-中最后一个元素">删除 list 中最后一个元素</h2>

<p><a href="http://stackoverflow.com/questions/627435/how-to-remove-an-element-from-a-list-by-index-in-python">http://stackoverflow.com/questions/627435/how-to-remove-an-element-from-a-list-by-index-in-python</a></p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-prompt">&gt;&gt;&gt; </span>a = range(<span class="hljs-number">10</span>)
<span class="hljs-prompt">&gt;&gt;&gt; </span>a
[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-keyword">del</span> a[-<span class="hljs-number">1</span>]
<span class="hljs-prompt">&gt;&gt;&gt; </span>a
[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>]</code></pre>

<p>或者：</p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-prompt">&gt;&gt;&gt; </span>a.pop()
<span class="hljs-number">8</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>a
[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]</code></pre>

<p>看自己喜欢用哪一种吧～</p>

<p><br></p>



<h2 id="返回所有索引">返回所有索引</h2>

<p><a href="http://stackoverflow.com/questions/6294179/how-to-find-all-occurrences-of-an-element-in-a-list">http://stackoverflow.com/questions/6294179/how-to-find-all-occurrences-of-an-element-in-a-list</a></p>



<pre class="prettyprint"><code class="language-python hljs ">indices = [i <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> enumerate(my_list) <span class="hljs-keyword">if</span> x == <span class="hljs-string">"whatever"</span>]</code></pre>

<p>这一句话搞定，代码很 python～</p>

<p><br></p>



<h2 id="nltk-计算-bleu-值">NLTK 计算 BLEU 值</h2>

<p><a href="http://stackoverflow.com/questions/32395880/calculate-bleu-score-in-python/32395945#32395945">http://stackoverflow.com/questions/32395880/calculate-bleu-score-in-python/32395945#32395945</a></p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> nltk

hypothesis = [<span class="hljs-string">'It'</span>, <span class="hljs-string">'is'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'cat'</span>, <span class="hljs-string">'at'</span>, <span class="hljs-string">'room'</span>]
reference = [<span class="hljs-string">'It'</span>, <span class="hljs-string">'is'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'cat'</span>, <span class="hljs-string">'inside'</span>, <span class="hljs-string">'the'</span>, <span class="hljs-string">'room'</span>]

<span class="hljs-comment">#there may be several references</span>
BLEUscore = nltk.translate.bleu_score.sentence_bleu([reference], hypothesis)
<span class="hljs-keyword">print</span> BLEUscore</code></pre>

<p><br></p>



<h2 id="subprocess-模块">subprocess 模块</h2>

<p>在 python 程序中，调用 Terminal 运行脚本：</p>

<p><a href="http://stackoverflow.com/questions/89228/calling-an-external-command-in-python">http://stackoverflow.com/questions/89228/calling-an-external-command-in-python</a></p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> call

<span class="hljs-comment"># Way 1</span>
call([<span class="hljs-string">"ls"</span>, <span class="hljs-string">"-l"</span>])

<span class="hljs-comment"># Way 2</span>
subprocess.call([<span class="hljs-string">'ping'</span>, <span class="hljs-string">'localhost'</span>])

<span class="hljs-comment"># Way 3</span>
return_code = subprocess.call(<span class="hljs-string">"echo Hello World"</span>, shell=<span class="hljs-keyword">True</span>)</code></pre>

<p><br></p>



<h2 id="将字符串转为小写">将字符串转为小写</h2>



<pre class="prettyprint"><code class="language-python hljs ">x = <span class="hljs-string">'Hello world'</span>
<span class="hljs-keyword">print</span> x.lower()</code></pre>

<p><img src="http://img.blog.csdn.net/20161205231804452" alt="这里写图片描述" title=""></p>



<h2 id="cv2模块找不到问题">cv2模块找不到问题</h2>

<p>经常在编译完 OpenCV 之后，在 python 下面，我们想导入 cv2 模块：</p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> cv2</code></pre>

<p>这时候会找不到 cv2 模块，碰到这样的问题，通常编辑环境变量：</p>



<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-built_in">sudo</span> vim ~/.bashrc</code></pre>

<p>然后：</p>



<pre class="prettyprint"><code class="language-bash hljs "><span class="hljs-keyword">export</span> PYTHONPATH=/usr/local/lib/python2.<span class="hljs-number">7</span>/site-packages:<span class="hljs-variable">$PYTHONPATH</span></code></pre>

<p>或者：</p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> sys
sys.path.append(<span class="hljs-string">'/usr/local/lib/python2.7/site-packages'</span>)</code></pre>



<h2 id="datetime">datetime</h2>

<p>今天又看到一种新的计时方法：</p>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">print</span> <span class="hljs-string">'DONE (t=%0.2fs)'</span>%((datetime.datetime.utcnow() - time_t).total_seconds())</code></pre>



<h2 id="众数">众数</h2>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> mode
mode(data)</code></pre>



<h2 id="中位数">中位数</h2>



<pre class="prettyprint"><code class="language-python hljs "><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
np.median(data)</code></pre></div></body>
</html>